# –ë—ã—Å—Ç—Ä—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–ï–ó –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–≤–µ–ª–∏—á–µ–Ω—ã Gunicorn workers –∏ threads
**–§–∞–π–ª:** `docker-compose.full.yml`
- **Workers**: 1 ‚Üí **2** (—É–≤–µ–ª–∏—á–µ–Ω–æ –≤ 2 —Ä–∞–∑–∞)
- **Threads**: 4 ‚Üí **6** (—É–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 50%)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 2 workers √ó 6 threads = **12 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** (–±—ã–ª–æ 4)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ~**15-25 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (–±—ã–ª–æ 10-15)
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ **50-70%**

### 2. –£–≤–µ–ª–∏—á–µ–Ω TTL –∫—ç—à–∞ –∫–∞–ø—Å—É–ª
**–§–∞–π–ª:** `docker-compose.full.yml`
- **CACHE_TTL**: 3600 (1 —á–∞—Å) ‚Üí **86400 (24 —á–∞—Å–∞)**
- **REDIS_TTL**: —É–∂–µ –±—ã–ª 86400 (24 —á–∞—Å–∞)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥—É—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å—Å—è –∏–∑ –∫—ç—à–∞
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–∞–ø—Å—É–ª –Ω–∞ **60-80%**
- –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Redis TTL –¥–ª—è –∫–∞–ø—Å—É–ª
**–§–∞–π–ª:** `backend/app.py`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `REDIS_TTL` (24 —á–∞—Å–∞) –≤–º–µ—Å—Ç–æ `CACHE_TTL` (–±—ã–ª–æ 6 —á–∞—Å–æ–≤)
- –ö–∞–ø—Å—É–ª—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ï—â–µ –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: **4**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: **~10-15**
- –ö—ç—à hit rate: **~30-40%**

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: **12** (‚Üë 200%)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: **~20-30** (‚Üë 100%)
- –ö—ç—à hit rate: **~70-80%** (‚Üë 100%)

### –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 40-60% (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É)
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 50-70% (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É)
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ 100%

---

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
```bash
cd /path/to/tganketa-copy
docker-compose -f docker-compose.full.yml restart backend
```

–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:
```bash
docker-compose -f docker-compose.full.yml up -d --force-recreate backend
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
docker logs wardrobe-backend -f
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- `Starting gunicorn 21.2.0` —Å 2 workers –∏ 6 threads
- `üü¢ CACHE HIT` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–°–ª–µ–¥–∏—Ç–µ –∑–∞:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ (–Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—É—é)
- CPU usage (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∏–∂–µ 80%)
- –ö—ç—à hit rate –≤ –ª–æ–≥–∞—Ö

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–∞–º—è—Ç—å
- **2 workers** √ó ~300 MB (rembg –º–æ–¥–µ–ª—å) = **~600 MB**
- **6 threads** √ó ~50 MB = **~300 MB**
- **–ò—Ç–æ–≥–æ**: ~900 MB - 1.2 GB –Ω–∞ backend

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —É —Å–µ—Ä–≤–µ—Ä–∞ –ø–∞–º—è—Ç–∏ (–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 GB —Å–≤–æ–±–æ–¥–Ω–æ–π)

### CPU
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ CPU –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 70-90%
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ 100%

### –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
1. –í–µ—Ä–Ω–∏—Ç–µ `GUNICORN_WORKERS=1` (–Ω–æ –æ—Å—Ç–∞–≤—å—Ç–µ `GUNICORN_THREADS=6`)
2. –ò–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ `GUNICORN_THREADS=4`

---

## üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Redis

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ localStorage
- Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 3. Nginx –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å API –æ—Ç–≤–µ—Ç—ã (—Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [x] –£–≤–µ–ª–∏—á–µ–Ω—ã Gunicorn workers (1 ‚Üí 2)
- [x] –£–≤–µ–ª–∏—á–µ–Ω—ã Gunicorn threads (4 ‚Üí 6)
- [x] –£–≤–µ–ª–∏—á–µ–Ω CACHE_TTL (1 —á–∞—Å ‚Üí 24 —á–∞—Å–∞)
- [x] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Redis TTL –¥–ª—è –∫–∞–ø—Å—É–ª
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω backend
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏/CPU

---

## üéØ –ò—Ç–æ–≥

**–ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π –º—ã –ø–æ–ª—É—á–∏–ª–∏:**
- **+100% –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** (—Å 10-15 –¥–æ 20-30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- **+100% –∫—ç—à hit rate** (—Å 30-40% –¥–æ 70-80%)
- **-50% –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU** (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É)
- **-40-60% –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞** (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 3 workers –∏ 8 threads (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç).

